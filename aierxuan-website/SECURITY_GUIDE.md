# DeepSeek AI 翻译功能安全指南

## 🔒 安全架构说明

### API密钥保护
- ✅ **后端存储**: API密钥 `DEEPSEEK_API_KEY` 仅存储在服务端环境变量中
- ✅ **前端隔离**: 前端代码完全无法访问API密钥
- ✅ **安全传输**: 通过HTTPS + Bearer Token进行API认证

### 身份验证
- ✅ **管理员验证**: 只有认证的管理员才能使用翻译功能
- ✅ **JWT Token**: 使用Supabase JWT进行用户身份验证
- ✅ **角色检查**: 验证用户角色为'admin'

### 数据安全
- ✅ **内容验证**: 后端验证输入内容的完整性
- ✅ **错误处理**: 安全的错误信息，不暴露系统内部信息
- ✅ **速率限制**: API调用间隔限制，防止滥用

## 🛡️ 安全措施

### 1. API密钥安全
```bash
# .env.local - 仅服务端可访问
DEEPSEEK_API_KEY=sk-7e51986f166f4e339874bd2698d747d5
```

### 2. 访问控制
- 管理员身份验证
- JWT Token验证
- 用户角色检查

### 3. 请求安全
- HTTPS传输
- 请求签名验证
- 防止CSRF攻击

### 4. 错误安全
- 敏感信息过滤
- 统一错误处理
- 日志记录监控

## 📋 部署前安全检查清单

### 环境变量配置
- [ ] `DEEPSEEK_API_KEY` 已配置且仅服务端可访问
- [ ] `NEXT_PUBLIC_SUPABASE_URL` 配置正确
- [ ] `SUPABASE_SERVICE_ROLE_KEY` 配置正确
- [ ] 确保没有将API密钥暴露在前端代码中

### 代码审查
- [ ] 前端代码中没有硬编码API密钥
- [ ] 所有API调用都通过后端进行
- [ ] 错误信息不包含敏感信息
- [ ] 用户输入验证完整

### 权限配置
- [ ] Supabase数据库中的用户角色表正确配置
- [ ] 管理员权限验证逻辑正确
- [ ] JWT Token过期时间合理

### 测试验证
- [ ] 非管理员用户无法访问翻译API
- [ ] 前端无法获取API密钥
- [ ] 翻译功能正常工作
- [ ] 错误处理机制正常

## 🚨 安全警告

### 绝对不要做的事情
1. **不要** 在前端代码中暴露API密钥
2. **不要** 将.env文件提交到版本控制系统
3. **不要** 在客户端日志中打印敏感信息
4. **不要** 跳过身份验证步骤

### 推荐做法
1. **定期** 轮换API密钥
2. **监控** API使用情况和成本
3. **记录** 翻译请求用于审计
4. **限制** API调用量和频率

## 🔧 故障排除

### 常见问题

#### 1. 身份验证失败
```
错误: "Unauthorized"
解决: 检查用户是否已登录且角色为admin
```

#### 2. API密钥未配置
```
错误: "DeepSeek API key未配置"
解决: 检查.env.local文件中的DEEPSEEK_API_KEY
```

#### 3. 翻译服务不可用
```
错误: "翻译服务暂时不可用"
解决: 检查DeepSeek API状态和网络连接
```

### 监控建议
1. 设置API成本监控
2. 监控翻译成功率
3. 定期检查错误日志
4. 设置成本超限告警

## 📞 技术支持

如果遇到安全问题，请立即：
1. 停止使用翻译功能
2. 检查系统日志
3. 联系技术支持团队
4. 必要时重新生成API密钥

---
**重要提醒**: 本功能涉及API密钥安全，请严格按照本指南进行配置和部署。